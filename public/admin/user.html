<!-- 

-->

<!DOCTYPE html>
<html lang="es">
    <head>
        <title>Medellín en la Cabeza</title>
        
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        
        <link rel="shortcut icon" type="image/x-icon" href="../assets/images/favicon.ico" />
        
    </head>
    
    <body>                
        <!--Inicio barra de navegación-->
        <nav class="navbar navbar-inverse navbar-fixed-top" role="navigation" id="navbar-top"></nav>
        <!-- Fin barra de navegación-->
        
        <!-- Inicio header (cabecera)-->
        <!-- Half Page Image Background Carousel Header -->
        <header id="myCarousel" class="carousel slide" data-ride="carousel"></header>
        <!-- Fin header (cabecera)-->
                    
        <!-- Inicio contenido - (formulario principal) -->
        <div id="container" class="modal-dialog container-top">
            <input type="hidden" name="txtPage" id="txtPage" data-page="records"/>
            
            <div id="user-session-div" class="text-left text-capitalize user-session-div">
                usuario: 
                <!--<a href="#!" class="">-->
                    <span id="user-session" class="user-session navbar-link"></span>
                <!--</a>-->
            </div>
            
            <div id="menu-register" class="text-capitalize">
                <a href="#!" title="nuevo" id="newRecord">nuevo registro</a>
                |
                <a href="#!" title="recargar" id="reloadPage">recargar página</a>
                |
                <a href="#!" title="cerrar sesión" id="closeSession">Cerrar sesión</a>
            </div>
            
            <hr/>
            
            <h1 class="h1 text-capitalize">usuarios</h1>
            
            <p>&nbsp;</p>
            
            <!--Formulario-->
            <div class="row" id="divForm">
                <form role="form" name="frmRegister" id="frmRegister" class="text-capitalize" enctype="multipart/form-data">
                      
                    <input type="text" name="txtId" id="txtId" class="hideElement" value="" disabled="disabled"/>
                    
                    <div class="row">
                        <div class="col-sm-8"> 
                            <div class="form-group" id="divUser">
                                <label for="txtUser" class="control-label">usuario</label>
                                <div class="input-group">
                                    <span class="input-group-addon">
                                        <img src="../assets/css/glyphicons_free/glyphicons_free/glyphicons/png/glyphicons-4-user.png"/>
                                    </span>
                                    <input type="text" name="txtUser" id="txtUser" class="form-control input-lg" placeholder="usuario" maxlength="50" data-toggle="tooltip" data-placement="bottom" data-validate="validate(required, minlength(3))" title="ingrese el usuario" disabled="disabled"/>                        
                                </div>                   
                            </div>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-sm-8"> 
                            <div class="form-group" id="divEmail">
                                <label for="txtEmail" class="control-label">correo</label>
                                <div class="input-group">
                                    <span class="input-group-addon">
                                        <img src="../assets/css/glyphicons_free/glyphicons_free/glyphicons/png/glyphicons-11-envelope.png"/>
                                    </span>
                                    <input type="email" name="txtEmail" id="txtEmail" class="form-control input-lg" placeholder="correo" maxlength="200" data-toggle="tooltip" data-placement="bottom" data-validate="validate(required, email)" title="ingrese el correo" disabled="disabled"/>                        
                                </div>                   
                            </div>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-sm-8"> 
                            <div class="form-group" id="divName">
                                <label for="txtName" class="control-label">nombre</label>
                                <div class="input-group">
                                    <span class="input-group-addon">
                                        <img src="../assets/css/glyphicons_free/glyphicons_free/glyphicons/png/glyphicons-609-newspaper.png"/>
                                    </span>
                                    <input type="text" name="txtName" id="txtName" class="form-control input-lg" placeholder="nombre" maxlength="50" data-toggle="tooltip" data-placement="bottom" data-validate="validate(required, minlength(3))" title="ingrese el nombre" disabled="disabled"/>                        
                                </div>                   
                            </div>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-sm-8"> 
                            <div class="form-group" id="divName">
                                <label for="txtPassword" class="control-label">contraseña</label>
                                <div class="input-group">
                                    <span class="input-group-addon">
                                        <img src="../assets/css/glyphicons_free/glyphicons_free/glyphicons/png/glyphicons-609-newspaper.png"/>
                                    </span>
                                    <input type="password" name="txtPassword" id="txtPassword" class="form-control input-lg" placeholder="contraseña" maxlength="30" data-toggle="tooltip" data-placement="bottom" data-validate="validate(required, minlength(8))" title="ingrese la contraseña" disabled="disabled"/>                        
                                </div>                   
                            </div>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-sm-8"> 
                            <div class="form-group" id="divAddress">
                                <label for="txtAddress" class="control-label">dirección</label>
                                <div class="input-group">
                                    <span class="input-group-addon">
                                        <img src="../assets/css/glyphicons_free/glyphicons_free/glyphicons/png/glyphicons-620-industrial-zone.png"/>
                                    </span>
                                    <input type="text" name="txtAddress" id="txtAddress" class="form-control input-lg" placeholder="dirección" maxlength="100" data-toggle="tooltip" data-placement="bottom" data-validate="validate()" title="ingrese la dirección" disabled="disabled"/>                        
                                </div>                   
                            </div>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-sm-8"> 
                            <div class="form-group" id="divPhone">
                                <label for="txtPhone" class="control-label">teléfono</label>
                                <div class="input-group">
                                    <span class="input-group-addon">
                                        <img src="../assets/css/glyphicons_free/glyphicons_free/glyphicons/png/glyphicons-442-phone-alt.png"/>
                                    </span>
                                    <input type="tel" name="txtPhone" id="txtPhone" class="form-control input-lg" placeholder="teléfono" maxlength="20" data-toggle="tooltip" data-placement="bottom" data-validate="validate()" title="ingrese el teléfono" disabled="disabled"/>                        
                                </div>                   
                            </div>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-sm-8"> 
                            <div class="form-group" id="divCellPhone">
                                <label for="txtCellPhone" class="control-label">celular</label>
                                <div class="input-group">
                                    <span class="input-group-addon">
                                        <img src="../assets/css/glyphicons_free/glyphicons_free/glyphicons/png/glyphicons-337-iphone-shake.png"/>
                                    </span>
                                    <input type="tel" name="txtCellPhone" id="txtCellPhone" class="form-control input-lg" placeholder="teléfono celular" maxlength="20" data-toggle="tooltip" data-placement="bottom" data-validate="validate()" title="ingrese el teléfono celular" disabled="disabled"/>                        
                                </div>                   
                            </div>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-sm-8"> 
                            <div class="form-group" id="divDescription">
                                <label for="txtDescription" class="control-label">descripción</label>
                                <div class="input-group">
                                    <span class="input-group-addon">
                                        <img src="../assets/css/glyphicons_free/glyphicons_free/glyphicons/png/glyphicons-40-notes.png"/>
                                    </span>
                                    <textarea name="txtDescription" id="txtDescription" class="form-control input-lg" placeholder="descripción" maxlength="300" data-toggle="tooltip" data-placement="bottom" data-validate="validate()" title="ingrese una descripción" disabled="disabled"></textarea>
                                </div>                   
                            </div>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-sm-8"> 
                            <div class="form-group" id="divActive">
                                <label for="optActive" class="control-label">activo</label>
                                <div class="row">
                                    <div class="col-sm-6">
                                        <div class="btn-group" data-toggle="buttons">
        <!--                                    <span class="input-group-addon">
                                                <img src="css/glyphicons_free/glyphicons_free/glyphicons/png/glyphicons-170-record.png"/>
                                            </span>-->
                                            <label class="btn btn-primary active">si 
                                                <input type="radio" class="form-control" name="optActive" id="optActiveYes" value="1" data-toggle="tooltip" data-placement="bottom" title="si" checked="checked" disabled="disabled">
                                            </label>
                                            <label class="btn btn-primary">no 
                                                <input type="radio" class="form-control" name="optActive" id="optActiveNo" value="0" data-toggle="tooltip" data-placement="bottom" title="no" disabled="disabled">
                                            </label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-sm-8"> 
                            <div class="form-group" id="divBirthDate">
                                <label for="txtBirthDate" class="control-label">Fecha nacimiento</label>
                                <div class="input-group">
                                    <span class="input-group-addon">
                                        <img src="../assets/css/glyphicons_free/glyphicons_free/glyphicons/png/glyphicons-46-calendar.png"/>
                                    </span>
                                    <input type="text" name="txtBirthDate" id="txtBirthDate" class="form-control input-lg" placeholder="fecha de nacimiento" readonly="readonly" data-toggle="tooltip" data-placement="bottom" data-validate="validate()" title="Ingrese la fecha de nacimiento" disabled="disabled"/>
                                    <span class="input-group-addon">
                                        <img src="../assets/css/glyphicons_free/glyphicons_free/glyphicons/png/glyphicons-257-delete.png" id="imgDeleteDate" title="Borrar fecha"/>
                                    </span>
                                </div>
                                <!--&nbsp;
                                <img src="images/calendar.jpg" id="imgCalendario" class="imgCalendario"/>-->
                            </div>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-sm-6"> 
                            <div class="form-group" id="divLogo">
                                <label for="fleLogo" class="control-label">imagen</label>
                                <div class="input-group">
                                    <span class="input-group-addon">
                                        <img src="../assets/css/glyphicons_free/glyphicons_free/glyphicons/png/glyphicons-12-camera.png"/>
                                    </span>
                                    <input type="file" name="fleLogo" id="fleLogo" class="form-control input-lg" data-toggle="tooltip" data-placement="bottom" data-validate="validate(required)" title="seleccione una imagen (gif, jpg, png - máx 2MB)" disabled="disabled"/>                        
                                </div>
                            </div>
                        </div>
                        <div class="col-sm-6"> 
                            <div class="form-group" id="divLogoView">
                                <img id="logoViewUpdate" class="img-thumbnail hide" alt="" src="#" />
                                <input type="hidden" name="txtLogoView" id="txtLogoView" value="" />
                            </div>
                        </div>
                    </div>
                                     
                    <div class="form-group">
                        <input type="button" value="enviar datos" class="btn btn-primary" id="btnSave" title="enviar datos" disabled="disabled"/>
                        <input type="reset" value="restablecer" class="btn btn-info" id="btnReset" title="restablecer" disabled="disabled"/>
                    </div>

                </form>
            </div>
            <!--Fin Formulario-->
            
            <!--Datos de la base de datos-->
            <table id='tableData' class='table table-striped table-hover'>
            <caption><div id='resultTotal'></div></caption>
                <thead>
                    <tr class="success text-capitalize">
                        <th>usuario</th>
                        <th>correo</th>
                        <th>nombre</th>
                        <th>activo</th>
                        <th>foto</th>
                        <th>eliminar</th>
                    </tr>
                </thead>
                <tbody>

                </tbody>
            </table>
            <!--Fin datos de la base de datos-->
            
            <div id="content-common"></div> 
                        
        </div>
        <!-- Fin contenido -->
        
        <!-- Inicio pie de página -->
        <footer id="footer" class="page-footer font-small blue pt-4 mt-4 navbar-color">
            
            <div id="footer-links" class="container-fluid text-center text-md-left"></div>
            
            <div id="footer-date" class="footer-copyright text-center py-3 text-capitalize">
                &copy; <span id="footer-date-copyright"></span> copyright:
                <a href="#!">medellín en la cabeza</a>
            </div>
            
        </footer>
        <!-- Fin pie de página -->
               
        <!--Scripts de la página-->
        <script type="text/javascript" src="../assets/js/jquery-2.1.4.js"></script> 
        <!--<script type="text/javascript" src="../assets/js/jquery-ui-1.11.4.custom/jquery-ui.js"></script>-->
        <script type="text/javascript" src="../assets/js/jquery-ui-1.12.1.custom/jquery-ui.js"></script>
        <script type="text/javascript" src="../assets/css/bootstrap-3.3.6/dist/js/bootstrap.js"></script>
        <script type="text/javascript" src="../assets/js/jquery.ketchup.0.3.2/js/jquery.ketchup.js"></script>
        <script type="text/javascript" src="../assets/js/jquery.ketchup.0.3.2/js/jquery.ketchup.validations.js"></script>
        <script type="text/javascript" src="../assets/js/jquery.dataTables.min.js"></script>
        <script type="text/javascript" src="../assets/js/dataTables.bootstrap.min.js"></script>
        <script type="text/javascript" src="../assets/js/scripts-commons.js"></script>
        <script type="text/javascript" src="../assets/js/functions-commons.js"></script>
        <script type="text/javascript" src="../assets/js/select2-4.0.6-rc.1/dist/js/select2.full.js"></script>
        <script type="text/javascript" src="../assets/js/jquery-te-1.4.0.min.js"></script>
        
        <div id="divStyles"></div>
        
        <script>
            $(function() { 
                
                $("#btnSave").click(function(){
                    $("#txtUser").val($("#txtUser").val().trim());
                    $("#txtEmail").val($("#txtEmail").val().trim());
                    $("#txtName").val($("#txtName").val().trim());
                    $("#txtPassword").val($("#txtPassword").val().trim());
                    $("#txtAddress").val($("#txtAddress").val().trim());
                    $("#txtPhone").val($("#txtPhone").val().trim());
                    $("#txtCellPhone").val($("#txtCellPhone").val().trim());
                    $("#txtDescription").val($("#txtDescription").val().trim());
                    $("#txtBirthDate").val($("#txtBirthDate").val().trim());
                    if(validateLength($("#divUser"), $("#txtUser"), 3)){
                        $('#txtEmail').focus();
                        if(validateEmail($("#divEmail"), $("#txtEmail"))){
                            $('#txtName').focus();
                            if(validateLength($("#divName"), $("#txtName"), 3)){
                                $('#txtPassword').focus();
                                if(validateLength($("#divPassword"), $("#txtPassword"), 8)){
                                    $('#fleLogo').focus();
                                    var isFile = false;
                                    if($("#txtLogoView").val().trim().length === 0){
                                        isFile = true;
                                    }else{
                                        if($("#txtLogoView").val() !== $("#logoViewUpdate").attr('src')){
                                            isFile = true;
                                        }
                                    }

                                    if(isFile){
                                        isFile = validateFile($("#divLogo"), $("#fleLogo")[0], 2097152);
                                    }else{
                                        isFile = true;
                                    }

                                    if(isFile){
                                        $("#frmRegister").find('input, textarea').blur();
                                        var fields = {
                                            'id': $("#txtId").val(),
                                            'user': $("#txtUser").val(),
                                            'email': $("#txtEmail").val(),
                                            'name': $("#txtName").val(),
                                            'password': $("#txtPassword").val(),
                                            'address': $("#txtAddress").val(),
                                            'phone': $("#txtPhone").val(),
                                            'cell_phone': $("#txtCellPhone").val(),
                                            'description': $("#txtDescription").val(),
                                            'birth_date': $("#txtBirthDate").val(),
                                            'active': $("#optActiveYes").is(':checked') ? 1 : 0
                                        };

                                        saveRecord(entity, fields, folder);
                                        resetForm();
                                        cleanForm();
                                        enabledForm(true);
                                    }
                                }
                            }
                        }
                    }
                });
                
                
                //Validaciones focosout: longitud y otros       
                $("#txtUser").focusout(function(){
                    $("#txtUser").val($("#txtUser").val().trim());
                    return validateLength($("#divUser"), $("#txtUser"), 3);
                });
                
                
                $("#txtEmail").focusout(function(){
                    $("#txtEmail").val($("#txtEmail").val().trim());
                    return validateEmail($("#divEmail"), $("#txtEmail"));
                });
                
                
                $("#txtName").focusout(function(){
                    $("#txtName").val($("#txtName").val().trim());
                    return validateLength($("#divName"), $("#txtName"), 3);
                });
                
                
                $("#txtPassword").focusout(function(){
                    $("#txtPassword").val($("#txtPassword").val().trim());
                    return validateLength($("#divPassword"), $("#txtPassword"), 8);
                });
                
                
                $("#fleLogo").focusout(function(){
                    return validateFile($("#divLogo"), $("#fleLogo")[0], 2097152);
                });
                
                
                $("#fleLogo").change(function(){
                    readURL(this);
                });
                
                
                // Plugin jQuery Text Editor
                $('.jqte-test').jqte();
                
                
                $("#imgDeleteDate").click(function(e){
                    $("#txtBirthDate").val(""); 
                    $("#txtBirthDate").focus();
                });
                
                
                //Ajustes en el datepicker 
                var date = new Date();
                var rangeMin = date.getFullYear() - 1900;
                var rangeMax = 0;
                
                $("#txtBirthDate").datepicker({
//                    buttonImage: "images/calendar.jpg",
                    buttonImageOnly: true,
                    changeYear: true,
                    changeMonth: true,
                    //yearRange: '-116:+100',
                    yearRange: '-' + rangeMin + ':+' + rangeMax,
                    maxDate:'+0m +0d',
                    showButtonPanel: true      
                });
                               
                $("#txtBirthDate").change(function(){
                    $("#txtBirthDate").focus();                   
                });
                                                                                     
                //Fin ajustes datepicker
                
            });
            
                        
            //****************************
            //Funciones Javascript
            //****************************
            
            entity = 'melc_user';
            folder = 'user';
            
            
            function loadRecords()
            {
                var objJson = {
                    'bd': {
                        'table': entity
                    },
                    fields: {
                        '0': 'id',
                        '1': 'name',
                        '2': 'user',
                        '3': 'email',
                        '4': 'password',
                        '5': 'address',
                        '6': 'phone',
                        '7': 'cell_phone',
                        '8': 'active',
                        '9': 'description',
                        '10': 'birth_date',
                        '11': 'logo'
                    }                   
                }
                
                var strJson = JSON.stringify(objJson);
                var active;
                 
                $.ajax({
                    url: urlListRecord,
                    data: {'dataSend': strJson},
                    type: 'POST',
                    dataType: 'json',
                    success: function(data) {
                        var table = "";
                        $.each(data, function(index, value){
                            active = value.active == 1 ? 'si' : 'no';
                            table += "<tr class='info'>";
                            table += "<td>";
                            table += "<a href='#!' title='editar' onclick='updateRecord(" + JSON.stringify(value) + ");'>" + value.user + "</a>";
                            table += "</td>";
                            table += "<td>" + value.email + "</td>";
                            table += "<td>" + value.name + "</td>";
                            table += "<td>" + active + "</td>";
                            table += "<td>";  
                            if(value.logo !== ''){
                                table += "<img src='../assets/images/user/" + value.logo + "' class='img-thumbnail zoom'/>";  
                            }else{
                                table += "<img src='assets/images/no-photo.jpg' class='img-thumbnail zoom'/>";
                            }
                            table += "</td>";
                            table += "<td>";
                            table += "<a href='#!' class='link-delete' onclick='deleteRecord(\"" + entity + "\", \"" + folder + "\", " + value.id +")'>";
                            table += "<img src='assets/images/delete.png' class='img-thumbnail' width='30' height='30' title='eliminar' alt='eliminar'>";
                            table += "</a>";
                            table += "</td>";
                            table += "</tr>";
                        });
                        $('#tableData tbody').html(table);
                        $('#tableData').DataTable({
                            retrieve: true,
                            language:{
                                "sProcessing":     "Procesando...",
                                "sLengthMenu":     "Mostrar _MENU_ registros",
                                "sZeroRecords":    "No se encontraron resultados",
                                "sEmptyTable":     "Ningún dato disponible en esta tabla",
                                "sInfo":           "Mostrando registros del _START_ al _END_ de un total de _TOTAL_ registros",
                                "sInfoEmpty":      "Mostrando registros del 0 al 0 de un total de 0 registros",
                                "sInfoFiltered":   "(filtrado de un total de _MAX_ registros)",
                                "sInfoPostFix":    "",
                                "sSearch":         "Buscar:",
                                "sUrl":            "",
                                "sInfoThousands":  ",",
                                "sLoadingRecords": "Cargando...",
                                "oPaginate": {
                                    "sFirst":    "Primero",
                                    "sLast":     "Último",
                                    "sNext":     "Siguiente",
                                    "sPrevious": "Anterior"
                                },
                                "oAria": {
                                    "sSortAscending":  ": Activar para ordenar la columna de manera ascendente",
                                    "sSortDescending": ": Activar para ordenar la columna de manera descendente"
                                }
                            }
                        });
                    }
                    
                }); 
                
                $.ajax({
                    url: urlTotalRecord + entity,
                    type: 'GET',
                    dataType: 'json',
                    success: function(data) {
                        $('#resultTotal').html('Listado de registros. Total registros: ' + data.totalRecords);
                    }                    
                });                
            }
                        
            
            function updateRecord(objFields)
            {
                $( "#dialog" ).html("¿está seguro?");
                $( "#dialog" ).dialog({
                    autoOpen: true,
                    modal: true,
                    buttons: {
                        "aceptar": function () {
                            $(this).dialog("close"); 
                            $("#txtId").val(objFields.id);
                            $("#txtUser").val(objFields.user);
                            $("#txtEmail").val(objFields.email);
                            $("#txtName").val(objFields.name);
                            $("#txtPassword").val(objFields.password);
                            $("#txtAddress").val(objFields.address);
                            $("#txtPhone").val(objFields.phone);
                            $("#txtCellPhone").val(objFields.cell_phone);
                            $("#txtDescription").val(objFields.description);
                            $("#txtBirthDate").val(objFields.birth_date);
                            $("#txtBirthDate").datepicker("setDate", new Date(objFields.birth_date));
                            if(objFields.active == 1){
                                $("#optActiveYes").prop('checked', true);
                            }else{ 
                                $("#optActiveNo").prop('checked', true);
                            }
                            if(objFields.logo.trim().length > 0){
                                $("#logoViewUpdate").attr('class', 'show img-thumbnail');
                                $("#logoViewUpdate").attr('src', '../assets/images/user/' + objFields.logo);
                                $("#txtLogoView").val('../assets/images/user/' + objFields.logo);
                            }
                            resetForm("update");
                            enabledForm(false);
                        },
                        "cancelar": function(){
                           $(this).dialog("close"); 
                        }
                    } 

                });
            }
            
            
        </script>
        
    </body>
</html>
